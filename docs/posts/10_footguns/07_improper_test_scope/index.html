<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Footgun #7 - Improper Test Scope | Shai Geva</title>
<meta name="keywords" content="">
<meta name="description" content="(this post is part of a series about good testing practices)
Let’s say our Book Store is a web service, and it uses a DB.
We’ll think about two alternative test suites - “behavior tests” and “implementation tests”
And try to imagine what our life will look like if we would have chosen one test suite or the other.
We’ll look at an almost identical test in both test suites.
The test verifies that if we edit the description of a book, then it has really been updated.
Pretty simple.">
<meta name="author" content="Shai Geva">
<link rel="canonical" href="https://shaigeva.com/posts/10_footguns/07_improper_test_scope/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://shaigeva.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://shaigeva.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shaigeva.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shaigeva.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://shaigeva.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://shaigeva.com/posts/10_footguns/07_improper_test_scope/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWC9X8YE9C"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-YWC9X8YE9C');
        }
      </script><meta property="og:title" content="Footgun #7 - Improper Test Scope" />
<meta property="og:description" content="(this post is part of a series about good testing practices)
Let’s say our Book Store is a web service, and it uses a DB.
We’ll think about two alternative test suites - “behavior tests” and “implementation tests”
And try to imagine what our life will look like if we would have chosen one test suite or the other.
We’ll look at an almost identical test in both test suites.
The test verifies that if we edit the description of a book, then it has really been updated.
Pretty simple." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shaigeva.com/posts/10_footguns/07_improper_test_scope/" />
<meta property="og:image" content="https://shaigeva.com/10_footguns/10_footguns_07_improper_test_scope.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-05-16T10:16:56+03:00" />
<meta property="article:modified_time" content="2025-05-16T10:16:56+03:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://shaigeva.com/10_footguns/10_footguns_07_improper_test_scope.png" />
<meta name="twitter:title" content="Footgun #7 - Improper Test Scope"/>
<meta name="twitter:description" content="(this post is part of a series about good testing practices)
Let’s say our Book Store is a web service, and it uses a DB.
We’ll think about two alternative test suites - “behavior tests” and “implementation tests”
And try to imagine what our life will look like if we would have chosen one test suite or the other.
We’ll look at an almost identical test in both test suites.
The test verifies that if we edit the description of a book, then it has really been updated.
Pretty simple."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://shaigeva.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Footgun #7 - Improper Test Scope",
      "item": "https://shaigeva.com/posts/10_footguns/07_improper_test_scope/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Footgun #7 - Improper Test Scope",
  "name": "Footgun #7 - Improper Test Scope",
  "description": "(this post is part of a series about good testing practices)\nLet’s say our Book Store is a web service, and it uses a DB.\nWe’ll think about two alternative test suites - “behavior tests” and “implementation tests” And try to imagine what our life will look like if we would have chosen one test suite or the other.\nWe’ll look at an almost identical test in both test suites.\nThe test verifies that if we edit the description of a book, then it has really been updated. Pretty simple.\n",
  "keywords": [
    
  ],
  "articleBody": "(this post is part of a series about good testing practices)\nLet’s say our Book Store is a web service, and it uses a DB.\nWe’ll think about two alternative test suites - “behavior tests” and “implementation tests” And try to imagine what our life will look like if we would have chosen one test suite or the other.\nWe’ll look at an almost identical test in both test suites.\nThe test verifies that if we edit the description of a book, then it has really been updated. Pretty simple.\nBoth tests have the same flow - Create a book Edit the book Get the updated description Make the assertion.\nThe behavior test does everything through the external http API, IN THE SAME WAY things would be done in the actual system.\nThe implementation test does some of the things at a lower level: It creates the book by directly creating a record in the database, and it also checks the updated description through the DB.\nSo the behavior test only looks at the WHAT - It looks at things as they appear from outside.\nThe implementation test also knows about HOW. It knows how the code will change the DB.\nNow, checking the implementation like this will USUALLY be equivalent to the behavior - but not always.\nBut why does this matter to us?\nLet’s look at a possible scenario: We’ve had this test suite for a while, maybe even years. We’ve invested a lot in them, and we rely on them.\nNow, we’re making a change to optimize the database.\nWe’re moving the description out of the Book table, and into a separate table.\nHowever, we’re not deleting the old field yet - we’ll do that later after all the data has moved to the new table.\nNow, we’re finished with everything else, and, it’s time to update the edit-book endpoint.\nNow, what if we just forgot to update the edit-book endpoint? Completely forgot.\nIt now changes the wrong field in the database so behavior-wise, it doesn’t do anything. If this gets to production, then we created a major bug.\nIf we chose behavior tests - The test only uses the external API. The behavior test…\nDoes not care about implementation details. So if the behavior is wrong, the test will fail, just like it should.\nThe regression bug was prevented. Everything’s ok.\nIf we chose the implementation test -\nThe test looks directly at old description field in the DB. When we run the test, the old description field will change, just like before, so the test will not fail.\nThe regression bug was not prevented. And a major bug made it to production.\nIt’s not ok.\nOn the other side of this, what if we made the change correctly? Edit book now changes the new table instead of the old field. No bugs, everything’s fine.\nIf we chose the behavior test - Everything behaves correctly, so the test will pass. We don’t need to do anything.\nIf we chose the implementation test - The old field is not updated any more, so even though the code is correct, this test will fail.\nThe distinction here is that the failure reason is not that the code is not correct. The test fails because it has become technically invalid.\nSo, we have extra work - we need to figure out whether the failure is real or technical. And then we’ll need to update the test. Also - because we changed the test, we now have less confidence in it. We need to learn to trust it again.\nOn large code bases, this can become a real pain. You have to update the tests, even if the code change has no bugs, and sometimes even if the test has nothing to do with the feature you worked on.\nYou end up wasting hours and you hate the test suite.\nSumming up\nCohesive, behavior tests - are closer to reality\nThey are better at protecting us. The create less redundant work And we have higher confidence in them in the long run.\nOne more thing worth mentioning: we looked at an example of a small, incremental change. But sometimes, we need to make BIG changes. SCARY changes. It happens less often but when it happens it’s a big deal.\nFor example, in a lot of companies, at some point, the DB doesn’t deal with the scale well. We have stability issues, and we need to make a big change - maybe move the data to a different type of database. And that’s when tests are MOST important.\nAnd if we went with behavior level tests - everything will be fine. Those same tests that we’ve been running with for 3 years now - we don’t change them. When they pass, we’re done.\nBut if we went with Implementation level tests - they all become technically invalid and they all fail. We will need to port all of them to use the new database, but more importantly: because we’re changing them - we’re not going to trust them enough.\nThis might make the difference between a project that takes a few weeks, and a company-level event that drags out for months while the product has stability issues.\nSo I cannot recommend enough. Test behavior. A cohesive whole.\nConclusion a\n\u003c\u003c previous post: Testing Too Many Things | next post: Test Doubles Everywhere \u003e\u003e ",
  "wordCount" : "902",
  "inLanguage": "en",
  "image":"https://shaigeva.com/10_footguns/10_footguns_07_improper_test_scope.png","datePublished": "2025-05-16T10:16:56+03:00",
  "dateModified": "2025-05-16T10:16:56+03:00",
  "author":{
    "@type": "Person",
    "name": "Shai Geva"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shaigeva.com/posts/10_footguns/07_improper_test_scope/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shai Geva",
    "logo": {
      "@type": "ImageObject",
      "url": "https://shaigeva.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shaigeva.com/" accesskey="h" title="Shai Geva (Alt + H)">Shai Geva</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shaigeva.com/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://shaigeva.com/talks" title="Talks">
                    <span>Talks</span>
                </a>
            </li>
            <li>
                <a href="https://shaigeva.com/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Footgun #7 - Improper Test Scope
    </h1>
    <div class="post-meta"><span title='2025-05-16 10:16:56 +0300 IDT'>May 16, 2025</span>&nbsp;·&nbsp;Shai Geva

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="https://shaigeva.com/10_footguns/10_footguns_07_improper_test_scope.png" alt="">
        
</figure>
  <div class="post-content"><p>(this post is part of a <a href="https://shaigeva.com/posts/10_footguns/ten_footguns/">series</a> about good testing practices)</p>
<p>Let’s say our Book Store is a web service, and it uses a DB.</p>
<p>We’ll think about two alternative test suites - “behavior tests” and “implementation tests”
And try to imagine what our life will look like if we would have chosen one test suite or the other.</p>
<p>We’ll look at an almost identical test in both test suites.</p>
<p>The test verifies that if we edit the description of a book, then it has really been updated.
Pretty simple.</p>
<p>Both tests have the same flow -
Create a book
Edit the book
Get the updated description
Make the assertion.</p>
<p>The behavior test does everything through the external http API, IN THE SAME WAY things would be done in the actual system.</p>
<p>The implementation test does some of the things at a lower level:
It creates the book by directly creating a record in the database, and it also checks the updated description through the DB.</p>
<p>So the behavior test only looks at the WHAT -
It looks at things as they appear from outside.</p>
<p>The implementation test also knows about HOW.
It knows how the code will change the DB.</p>
<p>Now, checking the implementation like this will USUALLY be equivalent to the behavior - but not always.</p>
<p>But why does this matter to us?</p>
<p>Let’s look at a possible scenario:
We’ve had this test suite for a while, maybe even years.
We’ve invested a lot in them, and we rely on them.</p>
<p>Now, we’re making a change to optimize the database.</p>
<p>We’re moving the description out of the Book table, and into a separate table.</p>
<p>However, we’re not deleting the old field yet - we’ll do that later after all the data has moved to the new table.</p>
<p>Now, we’re finished with everything else,
and, it’s time to update the edit-book endpoint.</p>
<p>Now, what if we just forgot to update the edit-book endpoint?
Completely forgot.</p>
<p>It now changes the wrong field in the database so behavior-wise, it doesn’t do anything.
If this gets to production, then we created a major bug.</p>
<p>If we chose behavior tests -
The test only uses the external API.
The behavior test…</p>
<p>Does not care about implementation details.
So if the behavior is wrong, the test will fail, just like it should.</p>
<p>The regression bug was prevented.
Everything’s ok.</p>
<p>If we chose the implementation test -</p>
<p>The test looks directly at old description field in the DB.
When we run the test, the old description field will change, just like before, so the test will not fail.</p>
<p>The regression bug was not prevented.
And a major bug made it to production.</p>
<p>It’s not ok.</p>
<p>On the other side of this, what if we made the change correctly?
Edit book now changes the new table instead of the old field.
No bugs, everything’s fine.</p>
<p>If we chose the behavior test -
Everything behaves correctly, so the test will pass.
We don’t need to do anything.</p>
<p>If we chose the implementation test -
The old field is not updated any more, so
even though the code is correct, this test will fail.</p>
<p>The distinction here is that the failure reason is not that the code is not correct.
The test fails because it has become technically invalid.</p>
<p>So, we have extra work - we need to figure out whether the failure is real or technical.
And then we’ll need to update the test.
Also - because we changed the test, we now have less confidence in it. We need to learn to trust it again.</p>
<p>On large code bases, this can become a real pain.
You have to update the tests, even if the code change has no bugs, and sometimes even if the test has nothing to do with the feature you worked on.</p>
<p>You end up wasting hours and you hate the test suite.</p>
<p>Summing up</p>
<p>Cohesive, behavior tests - are closer to reality</p>
<p>They are better at protecting us.
The create less redundant work
And we have higher confidence in them in the long run.</p>
<p>One more thing worth mentioning: we looked at an example of a small, incremental change.
But sometimes, we need to make BIG changes. SCARY changes.
It happens less often but when it happens it’s a big deal.</p>
<p>For example, in a lot of companies, at some point, the DB doesn’t deal with the scale well.
We have stability issues, and we need to make a big change - maybe move the data to a different type of database.
And that’s when tests are MOST important.</p>
<p>And if we went with behavior level tests - everything will be fine.
Those same tests that we’ve been running with for 3 years now - we don’t change them.
When they pass, we’re done.</p>
<p>But if we went with Implementation level tests - they all become technically invalid and they all fail.
We will need to port all of them to use the new database,
but more importantly: because we’re changing them - we’re not going to trust them enough.</p>
<p>This might make the difference between a project that takes a few weeks, and a company-level event that drags out for months while the product has stability issues.</p>
<p>So I cannot recommend enough.
Test behavior.
A cohesive whole.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>a</p>
<hr>

<div style="text-align: center; display: block; width: 100%;">
<a href="/posts/10_footguns/06_testing_too_many_things">&lt;&lt; previous post: Testing Too Many Things</a>
|
<a href="/posts/10_footguns/08_test_doubles_everywhere">next post: Test Doubles Everywhere &gt;&gt;</a>
</div>



  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://shaigeva.com/">Shai Geva</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
